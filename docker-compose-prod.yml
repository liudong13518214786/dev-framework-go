version: '3'

volumes:
  database_data:
    driver: local

services:
  webrelease: # 容器名字
#     image: liudongkenny/rpc:v3
    build: .
    container_name: webrelease
    command: go run main.go
    environment:
      - APP_ENV=release
      - DOMAIN=47.93.19.60
      - TZ=Asia/Shanghai
    volumes:
      - .:/go/src/dev-framework-go/
    ports:
      - "8890:8890" # 将内部的 8890 映射到外部的 6000
    depends_on:
      - db
      - redis
  db:
    image: postgres:9.4
    container_name: database_server
    volumes:
      - database_data:/var/lib/postgresql/data/
    ports:
      - "3432:5432"  # 第一个是暴露的端口，第二个是内部端口，外部访问3432对应内部的5432
    restart: always

  redis:
    image: redis:rc-alpine3.11
    container_name: cache_server
    command: redis-server --requirepass 123456
    ports:
      - "6379:6379"
    restart: always

  nginx:
    image: nginx:1.17
    ports:
      - "80:80"
    container_name: nginx_server
    restart: always
    volumes:
      - "./nginx_prod.conf:/etc/nginx/nginx.conf:ro"
      - "../kennyBlog/dist:/dist"
    networks:
      - "my-network"
    depends_on:
      - webrelease

networks: # 网络
  my-network: # 网络名称
    driver: bridge